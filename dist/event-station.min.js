/*
 * event-station v1.1.3
 * Copyright (c) Morris Allison III <author@morris.xyz> (http://morris.xyz). All rights reserved.
 * Released under the MIT license
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("event-station",e):t.EventStation=e()}(this,function(){"use strict";function t(t,e){var r=e.eventName,n=t.listenersMap;n[r]||(n[r]=[]);var i=e.stationMetas;i?i.push(t):e.stationMetas=[t],n[r].push(e),t.listenerCount++;var o=e.hearer;o&&o.stationMeta.hearingCount++}function e(t,e,r){if(r===!0)return t===e;var n=t.matchCallback;if(n&&n!==e.matchCallback)return!1;var i=t.matchContext;if(void 0!==i&&i!==e.matchContext)return!1;var o=t.hearer;if(o&&o!==e.hearer)return!1;var a=t.eventName;return void 0===a||a===e.eventName}function r(t,r,o){if(!(t.listenerCount<1)){var a=t.listenersMap,s=r.eventName,u=a[s];if(u){var c=u.length;if(1===c){if(!e(r,u[0],o))return;return delete a[s],t.listenerCount--,i(r),void n(t,r)}for(var l=0,f=c;l<f;l++){var h=u[l];e(r,h,o)&&(u.splice(l,1),t.listenerCount--,l--,f--,i(r),n(t,r))}u.length<1&&delete a[s]}}}function n(t,e){var r=e.stationMetas;if(r){if(1===r.length)return void(e.stationMetas=void 0);for(var n=[],i=0,o=r;i<o.length;i++){var a=o[i];a!==t&&n.push(a)}n.length<1?e.stationMetas=void 0:e.stationMetas=n}}function i(t){var e=t.hearer;e&&e.stationMeta.hearingCount--}function o(t){var e=t.stationMetas;if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n];r(o,t,!0)}}function a(t,e,r,n){var i=n.length,a=e.stationMeta;a.isPropagationStopped=!1;var s,u=[];t=t.slice();for(var c=0,l=t;c<l.length;c++){var f=l[c];if(a.isPropagationStopped)return void(a.isPropagationStopped=!1);if(!f.isPaused){var h=f.callback,v=f.context;if(h)switch(i){case 0:s=h.call(v);break;case 1:s=h.call(v,n[0]);break;case 2:s=h.call(v,n[0],n[1]);break;case 3:s=h.call(v,n[0],n[1],n[2]);break;default:s=h.apply(v,n)}r&&s&&"function"==typeof s.then&&"function"==typeof s.catch&&u.push(s);var p=f.resolves;if(p){for(var g=0,d=p;g<d.length;g++){var m=d[g];m(f)}f.resolves=void 0}var b=f.maxOccurrences,y=f.occurrences;void 0!==b&&(y=void 0===y?f.occurrences=1:++f.occurrences,y===b&&o(f))}}return u}function s(t){if(t.listenerCount<1)return[];var e=t.listenersMap,r=[];for(var n in e)r=r.concat(e[n]);return r}function u(t,r,n){var i=r.length;if(i<1)return!1;for(var o=0,a=r;o<a.length;o++){var s=a[o];if(e(t,s,n))return!0}return!1}function c(t,e,r){var n,i=t.listenersMap,o=e.eventName;if(void 0===o)n=s(t);else if(n=i[o],!n)return!1;return u(e,n,r)}function l(t,e){switch(t){case"rx":T.$RxObservable=e?e.Observable:e;break;case"Promise":T.$Promise=e;break;default:throw new Error("Invalid name")}}function f(){T.$RxObservable=void 0,T.$Promise=h()}function h(){var t="object"==typeof window?window:global;return t.Promise}function v(t){if(!T.$Promise)throw new Error("No promises implementation available.");return new T.$Promise(function(e){t.resolves?t.resolves.push(e):t.resolves=[e]})}function p(t){if(t.hearer)throw new Error("Cross-emitter listeners can't be cloned.");return{eventName:t.eventName,callback:t.callback,context:t.context,matchCallback:t.matchCallback,matchContext:t.matchContext,isPaused:t.isPaused,occurrences:t.occurrences,maxOccurrences:t.maxOccurrences}}function g(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];if(d(n))return!0}return!1}function d(t){return void 0!==t.stationMetas}function m(t,e,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(c(t,o,r))return!0}return!1}function b(){return String(++L)}function y(){w(q,H)}function M(t){var e=w({},q,t);x(e),w(q,t)}function x(t){if(""===t.delimiter)throw new Error("Invalid option: Delimiters can't be empty strings.");if(""===t.regExpMarker)throw new Error("Invalid option: RegExp markers can't be empty strings.");if(t.regExpMarker&&t.delimiter&&t.regExpMarker.indexOf(t.delimiter)>=0)throw new Error("Invalid option: RegExp markers can't contain the delimiter string.")}function w(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r){var i=H.hasOwnProperty(n),o=r[n];i&&null!=o&&(t[n]=o)}}return t}function C(t,e){var r;if("string"==typeof t){var n=e.delimiter;r=e.enableDelimiter&&n?t.split(n):[t]}else{if(!Array.isArray(t))throw new Error("Invalid first argument");r=t}return r}function P(t){void 0===t&&(t={});var e={heardStations:Object.create(null),hearingCount:0,isPropagationStopped:!1,listenerCount:0,listenersMap:Object.create(null),stationId:b()},r=w(e,q,t);return x(r),r}function O(t,e,r,n,i){if("string"==typeof r){var o=t.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),E(t,e,r,n,i)):[{eventName:r,callback:n,context:e||void 0!==i?i:t,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return E(t,e,r,n,i);if("object"==typeof r)return k(t,e,r,n);throw new Error("Invalid arguments")}function k(t,e,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:e||void 0!==n?n:t,matchCallback:r[o],matchContext:n});return i}function E(t,e,r,n,i){for(var o=[],a=r.length,s=0;s<a;s++)o.push({eventName:r[s],callback:n,context:e||void 0!==i?i:t,matchContext:i,matchCallback:n});return o}function S(t,e,r,n){var i,o=e.stationMeta,s=o.listenersMap;i=o.enableRegExp?j(t,s,o.regExpMarker):s[t];var u=[];if(i){var c=a(i,e,r,n);r&&c&&(u=u.concat(c))}var l=s[F];if(o.emitAllEvent&&l){var f=n.slice();f.splice(0,0,t);var c=a(l,e,r,f);r&&c&&(u=u.concat(c))}return u}function j(t,e,r){var n=[];for(var i in e)0===i.indexOf(r)?new RegExp(i.substr(r.length)).test(t)&&(n=n.concat(e[i])):i===t&&(n=n.concat(e[t]));return n}function N(t){var e=Object.create(null),r=t.stationMeta.heardStations;for(var n in r){var i=r[n];c(i.stationMeta,{hearer:t})&&(e[n]=i)}t.stationMeta.heardStations=e}function $(t){var e=t.listenersMap;for(var r in e)for(var n=e[r],i=0,o=n;i<o.length;i++){var a=o[i],s=a.hearer;s&&s.stationMeta.hearingCount--}t.listenerCount=0,t.listenersMap=Object.create(null)}function A(t,e){var r=e.listenersMap,n=r[t];if(void 0!==n){for(var i=n.length,o=0;o<i;o++){var a=n[o],s=a.hearer;s&&s.stationMeta.hearingCount--}e.listenerCount=e.listenerCount-i,delete r[t]}}function I(t,e){if(void 0===e)return R(t);if(Array.isArray(e))return e;if(e.stationMeta)return[e];throw new Error("Invalid target")}function R(t){var e=[],r=t.heardStations;for(var n in r)e.push(r[n]);return e}var T;!function(t){t.$RxObservable=void 0,t.$Promise=h()}(T||(T={}));var D=function(){function e(t,e){this.originStation=t,this.listeners=e}return Object.defineProperty(e.prototype,"count",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),e.prototype.occur=function(t){if(t<1)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.maxOccurrences=t}return this},e.prototype.calling=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.callback=t,i.matchCallback=t}return this},e.prototype.once=function(t){return this.calling(t).occur(1)},e.prototype.off=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];o(n)}return this},e.prototype.using=function(t){for(var e=this.listeners,r=0,n=e;r<n.length;r++){var i=n[r];i.context=t,i.matchContext=t}return this},e.prototype.addTo=function(e){for(var r=this.listeners,n=e.stationMeta,i=0,o=r;i<o.length;i++){var a=o[i],s=a.crossOrigin;if(s&&s!==e)throw new Error("Cross-emitter listeners can only be attached to their origin station.");t(n,a)}return this},e.prototype.removeFrom=function(t){for(var e=this.listeners,n=t.stationMeta,i=0,o=e;i<o.length;i++){var a=o[i];r(n,a,!0)}return this},e.prototype.moveTo=function(t){return this.removeFrom(this.originStation),this.originStation=t,this.addTo(t),this},e.prototype.has=function(t,e){return u(t,this.listeners,e)},e.prototype.attach=function(){return this.addTo(this.originStation)},e.prototype.detach=function(){return this.removeFrom(this.originStation)},e.prototype.isAttachedTo=function(t){return t?m(t.stationMeta,this.listeners,!0):g(this.listeners)},e.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},e.prototype.pause=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!0}return this},e.prototype.resume=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.isPaused=!1}return this},e.prototype.isPaused=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];if(n.isPaused)return!0}return!1},e.prototype.toPromises=function(){for(var t=[],e=this.listeners,r=e.length,n=0;n<r;n++){var i=e[n];t[n]=v(i)}return t},e.prototype.all=function(){return T.$Promise.all(this.toPromises())},e.prototype.race=function(){return T.$Promise.race(this.toPromises())},e.prototype.reset=function(){for(var t=this.listeners,e=0,r=t;e<r.length;e++){var n=r[e];n.occurrences=void 0,n.isPaused=void 0}return this},e.prototype.forEach=function(t){for(var e=this.listeners,r=e.length,n=0;n<r;n++){var i=e[n];t(i,n,e)}return this},e.prototype.get=function(t){return this.listeners[t]},e.prototype.index=function(t){for(var e=this.listeners,r=e.length,n=0;n<r;n++)if(t===e[n])return n},e.prototype.clone=function(){var t=this.listeners.map(p);return new e(this.originStation,t)},e}(),L=0,F="all",H={delimiter:" ",emitAllEvent:!0,enableDelimiter:!0,enableRegExp:!1,regExpMarker:"%"},q=w({},H),z=function(){function n(t){n.init(this,t)}return Object.defineProperty(n.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerEventNames",{get:function(){return Object.getOwnPropertyNames(this.stationMeta.listenersMap)},enumerable:!0,configurable:!0}),n.prototype.on=function(e,r,n){for(var i=this.stationMeta,o=O(this,!1,e,r,n),a=0,s=o;a<s.length;a++){var u=s[a];t(i,u)}return new D(this,o)},n.prototype.once=function(t,e,r){return this.on(t,e,r).occur(1)},n.prototype.off=function(t,e,n){var i=this.stationMeta;if(!(i.listenerCount<1)){if(void 0===t)return void $(i);if(void 0===e&&void 0===n&&"string"==typeof t&&(!i.enableDelimiter||t.indexOf(i.delimiter)<0))return void A(t,i);for(var o=O(this,!0,t,e,n),a=0,s=o;a<s.length;a++){var u=s[a];r(i,u)}}},n.prototype.hear=function(e,r,n,i){for(var o=this.stationMeta.heardStations,a=O(this,!1,r,n,i),s=e.stationMeta,u=0,c=a;u<c.length;u++){var l=c[u];l.hearer=this,l.crossOrigin=e,t(s,l),o[e.stationId]=e}return new D(e,a)},n.prototype.hearOnce=function(t,e,r,n){return this.hear(t,e,r,n).occur(1)},n.prototype.disregard=function(t,e,n,i){var o=this.stationMeta;if(!(o.hearingCount<1)){var a=!1,s=[];void 0===e?a=!0:s=O(this,!0,e,n,i);for(var u=I(o,t),c=u.length,l=0;l<c;l++){var f=u[l],h=f.stationMeta;a&&(e=f.listenerEventNames,s=O(this,!0,e,n,i));for(var v=0,p=s;v<p.length;v++){var g=p[v];g.hearer=this,r(h,g)}}a?o.heardStations=Object.create(null):N(this)}},n.prototype.isHeard=function(t,e,r){var n=this.stationMeta,i=n.listenerCount;if(i<1)return!1;if(arguments.length<1)return i>0;for(var o=O(this,!0,t,e,r),a=0,s=o;a<s.length;a++){var u=s[a];if(c(n,u))return!0}return!1},n.prototype.isHearing=function(t,e,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o=I(i,t),a=!1,s=[];e?s=O(this,!0,e,r,n):a=!0;for(var u=o.length,l=0;l<u;l++){var f=o[l],h=f.stationMeta;a&&(e=f.listenerEventNames,s=O(this,!0,e,r,n));for(var v=0,p=s;v<p.length;v++){var g=p[v];if(g.hearer=this,c(h,g))return!0}}return!1},n.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1))for(var i=C(t,n),o=0,a=i;o<a.length;o++){var s=a[o];S(s,this,!1,e)}},n.prototype.emitAsync=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!T.$Promise)throw new Error("No promises implementation available.");var n=this.stationMeta;if(n.listenerCount<1)return T.$Promise.resolve([]);for(var i=C(t,n),o=[],a=0,s=i;a<s.length;a++){var u=s[a];o=o.concat(S(u,this,!0,e))}return o.length>0?T.$Promise.all(o):T.$Promise.resolve([])},n.prototype.makeListeners=function(t,e,r){var n=O(this,!1,t,e,r);return new D(this,n)},n.prototype.getListeners=function(t,r,n){var i=s(this.stationMeta);if(!(i.length<1)){if(arguments.length<1)return new D(this,i);for(var o=O(this,!0,t,r,n),a=[],u=0,c=i;u<c.length;u++)for(var l=c[u],f=0,h=o;f<h.length;f++){var v=h[f];if(e(v,l)){a.push(l);break}}if(!(a.length<1))return new D(this,a)}},n.prototype.toObservable=function(t,e,r){var n=this;if(!T.$RxObservable)throw new Error("Rx has not been injected. See documentation for details.");var i=function(r){n.on(t,r,e)},o=function(r){n.off(t,r,e)};return T.$RxObservable.fromEventPattern(i,o,r)},n.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},n.prototype.addListener=function(e){t(this.stationMeta,e)},n.prototype.removeListener=function(t,e){r(this.stationMeta,t,e)},n.prototype.hasListener=function(t,e){return c(this.stationMeta,t,e)},n.init=function(t,e){return t.stationMeta=P(e),n},n.inject=function(t,e){return l(t,e),n},n.config=function(t){return M(t),n},n.reset=function(){return y(),f(),n},n.extend=function(t){for(var e=n.prototype,r=Object.keys(e),i=0,o=r;i<o.length;i++){var a=o[i],s=Object.getOwnPropertyDescriptor(e,a),u={configurable:!0};void 0!==s.get?u.get=s.get:u.value=s.value,Object.defineProperty(t,a,u)}return t},n.make=function(){var t=n.extend({});return n.init(t),t},n}();return z.EventStation=z,z.default=z,z});
//# sourceMappingURL=event-station.min.js.map
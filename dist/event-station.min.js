/*
 * event-station v1.1.3
 * Copyright (c) Morris Allison III <author@morris.xyz> (http://morris.xyz). All rights reserved.
 * Released under the MIT license
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("event-station",e):t.EventStation=e()}(this,function(){"use strict";function t(t,e){var r=e.eventName,n=t.listenersMap;n[r]||(n[r]=[]);var i=e.stationMetas;i?i.push(t):e.stationMetas=[t],n[r].push(e),t.listenerCount++;var o=e.hearer;o&&o.stationMeta.hearingCount++}function e(t,e,r){if(!0===r)return t===e;var n=t.matchCallback;if(n&&n!==e.matchCallback)return!1;var i=t.matchContext;if(void 0!==i&&i!==e.matchContext)return!1;var o=t.hearer;if(o&&o!==e.hearer)return!1;var a=t.eventName;return void 0===a||a===e.eventName}function r(t,r,o){if(!(t.listenerCount<1)){var a=t.listenersMap,s=r.eventName,u=a[s];if(u){var c=u.length;if(1===c){if(!e(r,u[0],o))return;return delete a[s],t.listenerCount--,i(r),void n(t,r)}for(var l=0,f=c;l<f;l++)e(r,u[l],o)&&(u.splice(l,1),t.listenerCount--,l--,f--,i(r),n(t,r));u.length<1&&delete a[s]}}}function n(t,e){var r=e.stationMetas;if(r)if(1!==r.length){for(var n=[],i=0,o=r;i<o.length;i++){var a=o[i];a!==t&&n.push(a)}n.length<1?e.stationMetas=void 0:e.stationMetas=n}else e.stationMetas=void 0}function i(t){var e=t.hearer;e&&e.stationMeta.hearingCount--}function o(t){var e=t.stationMetas;if(e)for(var n=0,i=e;n<i.length;n++)r(i[n],t,!0)}function a(t,e,r,n){var i=n.length,a=e.stationMeta;a.isPropagationStopped=!1;for(var s,u=[],c=0,l=t=t.slice();c<l.length;c++){var f=l[c];if(a.isPropagationStopped)return void(a.isPropagationStopped=!1);if(!f.isPaused){var h=f.callback,v=f.context;if(h)switch(i){case 0:s=h.call(v);break;case 1:s=h.call(v,n[0]);break;case 2:s=h.call(v,n[0],n[1]);break;case 3:s=h.call(v,n[0],n[1],n[2]);break;default:s=h.apply(v,n)}r&&s&&"function"==typeof s.then&&"function"==typeof s.catch&&u.push(s);var p=f.resolves;if(p){for(var g=0,d=p;g<d.length;g++)(0,d[g])(f);f.resolves=void 0}var m=f.maxOccurrences,b=f.occurrences;void 0!==m&&(void 0===b&&(b=0),f.occurrences=++b,b===m&&o(f))}}return u}function s(t){if(t.listenerCount<1)return[];var e=t.listenersMap,r=[];for(var n in e)r=r.concat(e[n]);return r}function u(t,r,n){if(r.length<1)return!1;for(var i=0,o=r;i<o.length;i++)if(e(t,o[i],n))return!0;return!1}function c(t,e,r){var n,i=t.listenersMap,o=e.eventName;if(void 0===o)n=s(t);else if(!(n=i[o]))return!1;return u(e,n,r)}function l(t,e){switch(t){case"rx":T.$RxObservable=e?e.Observable:e;break;case"Promise":T.$Promise=e;break;default:throw new Error("Invalid name")}}function f(){T.$RxObservable=void 0,T.$Promise=h()}function h(){return("object"==typeof window?window:global).Promise}function v(t){if(!T.$Promise)throw new Error(D.NO_PROMISE);return new T.$Promise(function(e){t.resolves?t.resolves.push(e):t.resolves=[e]})}function p(t){if(t.hearer)throw new Error("Cross-emitter listeners can't be cloned.");return{eventName:t.eventName,callback:t.callback,context:t.context,matchCallback:t.matchCallback,matchContext:t.matchContext,isPaused:t.isPaused,occurrences:t.occurrences,maxOccurrences:t.maxOccurrences}}function g(t){for(var e=0,r=t;e<r.length;e++)if(d(r[e]))return!0;return!1}function d(t){return void 0!==t.stationMetas}function m(t,e,r){for(var n=0,i=e;n<i.length;n++)if(c(t,i[n],r))return!0;return!1}function b(){return String(++_)}function y(){x(q,H)}function M(t){w(x({},q,t)),x(q,t)}function w(t){if(""===t.delimiter)throw new Error("Invalid option: Delimiters can't be empty strings.");if(""===t.regExpMarker)throw new Error("Invalid option: RegExp markers can't be empty strings.");if(t.regExpMarker&&t.delimiter&&t.regExpMarker.indexOf(t.delimiter)>=0)throw new Error("Invalid option: RegExp markers can't contain the delimiter string.")}function x(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r){var i=H.hasOwnProperty(n),o=r[n];i&&null!=o&&(t[n]=o)}}return t}function P(t,e){var r;if("string"==typeof t){var n=e.delimiter;r=e.enableDelimiter&&n?t.split(n):[t]}else{if(!Array.isArray(t))throw new Error("Invalid first argument");r=t}return r}function O(t){void 0===t&&(t={});var e=x({heardStations:Object.create(null),hearingCount:0,isPropagationStopped:!1,listenerCount:0,listenersMap:Object.create(null),stationId:b()},q,t);return w(e),e}function C(t,e,r,n,i){if("string"==typeof r){var o=t.stationMeta,a=o.enableDelimiter,s=o.delimiter;return a&&r.indexOf(s)>=0?(r=r.split(s),k(t,e,r,n,i)):[{eventName:r,callback:n,context:e||void 0!==i?i:t,matchCallback:n,matchContext:i}]}if(Array.isArray(r))return k(t,e,r,n,i);if("object"==typeof r)return E(t,e,r,n);throw new Error("Invalid arguments")}function E(t,e,r,n){var i=[];for(var o in r)i.push({eventName:o,callback:r[o],context:e||void 0!==n?n:t,matchCallback:r[o],matchContext:n});return i}function k(t,e,r,n,i){for(var o=[],a=r.length,s=0;s<a;s++)o.push({eventName:r[s],callback:n,context:e||void 0!==i?i:t,matchContext:i,matchCallback:n});return o}function S(t,e,r,n){var i,o=e.stationMeta,s=o.listenersMap,u=[];if(i=o.enableRegExp?N(t,s,o.regExpMarker):s[t]){f=a(i,e,r,n);r&&f&&(u=u.concat(f))}var c=s[F];if(o.emitAllEvent&&c){var l=n.slice();l.splice(0,0,t);var f=a(c,e,r,l);r&&f&&(u=u.concat(f))}return u}function N(t,e,r){var n=[];for(var i in e)0===i.indexOf(r)?new RegExp(i.substr(r.length)).test(t)&&(n=n.concat(e[i])):i===t&&(n=n.concat(e[t]));return n}function j(t){var e=Object.create(null),r=t.stationMeta.heardStations;for(var n in r){var i=r[n];c(i.stationMeta,{hearer:t})&&(e[n]=i)}t.stationMeta.heardStations=e}function $(t){var e=t.listenersMap;for(var r in e)for(var n=0,i=e[r];n<i.length;n++){var o=i[n].hearer;o&&o.stationMeta.hearingCount--}t.listenerCount=0,t.listenersMap=Object.create(null)}function I(t,e){var r=e.listenersMap,n=r[t];if(void 0!==n){for(var i=n.length,o=0;o<i;o++){var a=n[o].hearer;a&&a.stationMeta.hearingCount--}e.listenerCount=e.listenerCount-i,delete r[t]}}function R(t,e){if(void 0===e)return A(t);if(Array.isArray(e))return e;if(e.stationMeta)return[e];throw new Error("Invalid target")}function A(t){var e=[],r=t.heardStations;for(var n in r)e.push(r[n]);return e}var T;!function(t){t.$RxObservable=void 0,t.$Promise=h()}(T||(T={}));var D={NO_PROMISE:"No promises implementation available."},L=function(){function e(t,e){this.originStation=t,this.listeners=e}return Object.defineProperty(e.prototype,"count",{get:function(){return this.listeners.length},enumerable:!0,configurable:!0}),e.prototype.occur=function(t){if(t<1)throw new Error("The maximum occurrences must be greater than or equal to one.");for(var e=0,r=this.listeners;e<r.length;e++)r[e].maxOccurrences=t;return this},e.prototype.calling=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.callback=t,n.matchCallback=t}return this},e.prototype.once=function(t){return this.calling(t).occur(1)},e.prototype.off=function(){for(var t=0,e=this.listeners;t<e.length;t++)o(e[t]);return this},e.prototype.using=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.context=t,n.matchContext=t}return this},e.prototype.addTo=function(e){for(var r=this.listeners,n=e.stationMeta,i=0,o=r;i<o.length;i++){var a=o[i],s=a.crossOrigin;if(s&&s!==e)throw new Error("Cross-emitter listeners can only be attached to their origin station.");t(n,a)}return this},e.prototype.removeFrom=function(t){for(var e=this.listeners,n=t.stationMeta,i=0,o=e;i<o.length;i++)r(n,o[i],!0);return this},e.prototype.moveTo=function(t){return this.removeFrom(this.originStation),this.originStation=t,this.addTo(t),this},e.prototype.has=function(t,e){return u(t,this.listeners,e)},e.prototype.attach=function(){return this.addTo(this.originStation)},e.prototype.detach=function(){return this.removeFrom(this.originStation)},e.prototype.isAttachedTo=function(t){return t?m(t.stationMeta,this.listeners,!0):g(this.listeners)},e.prototype.isAttached=function(){return this.isAttachedTo(this.originStation)},e.prototype.pause=function(){for(var t=0,e=this.listeners;t<e.length;t++)e[t].isPaused=!0;return this},e.prototype.resume=function(){for(var t=0,e=this.listeners;t<e.length;t++)e[t].isPaused=!1;return this},e.prototype.isPaused=function(){for(var t=0,e=this.listeners;t<e.length;t++)if(e[t].isPaused)return!0;return!1},e.prototype.toPromises=function(){for(var t=[],e=this.listeners,r=e.length,n=0;n<r;n++){var i=e[n];t[n]=v(i)}return t},e.prototype.all=function(){if(!T.$Promise)throw new Error(D.NO_PROMISE);return T.$Promise.all(this.toPromises())},e.prototype.race=function(){if(!T.$Promise)throw new Error(D.NO_PROMISE);return T.$Promise.race(this.toPromises())},e.prototype.reset=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.occurrences=void 0,r.isPaused=void 0}return this},e.prototype.forEach=function(t){for(var e=this.listeners,r=e.length,n=0;n<r;n++)t(e[n],n,e);return this},e.prototype.get=function(t){return this.listeners[t]},e.prototype.index=function(t){for(var e=this.listeners,r=e.length,n=0;n<r;n++)if(t===e[n])return n},e.prototype.clone=function(){var t=this.listeners.map(p);return new e(this.originStation,t)},e}(),_=0,F="all",H={delimiter:" ",emitAllEvent:!0,enableDelimiter:!0,enableRegExp:!1,regExpMarker:"%"},q=x({},H),z=function(){function n(t){n.init(this,t)}return Object.defineProperty(n.prototype,"stationId",{get:function(){return this.stationMeta.stationId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerCount",{get:function(){return this.stationMeta.listenerCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hearingCount",{get:function(){return this.stationMeta.hearingCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listenerEventNames",{get:function(){return Object.getOwnPropertyNames(this.stationMeta.listenersMap)},enumerable:!0,configurable:!0}),n.prototype.on=function(e,r,n){for(var i=this.stationMeta,o=C(this,!1,e,r,n),a=0,s=o;a<s.length;a++)t(i,s[a]);return new L(this,o)},n.prototype.once=function(t,e,r){return this.on(t,e,r).occur(1)},n.prototype.off=function(t,e,n){var i=this.stationMeta;if(!(i.listenerCount<1))if(void 0!==t)if(void 0!==e||void 0!==n||"string"!=typeof t||i.enableDelimiter&&!(t.indexOf(i.delimiter)<0))for(var o=0,a=C(this,!0,t,e,n);o<a.length;o++)r(i,a[o]);else I(t,i);else $(i)},n.prototype.hear=function(e,r,n,i){for(var o=this.stationMeta.heardStations,a=C(this,!1,r,n,i),s=e.stationMeta,u=0,c=a;u<c.length;u++){var l=c[u];l.hearer=this,l.crossOrigin=e,t(s,l),o[e.stationId]=e}return new L(e,a)},n.prototype.hearOnce=function(t,e,r,n){return this.hear(t,e,r,n).occur(1)},n.prototype.disregard=function(t,e,n,i){var o=this.stationMeta;if(!(o.hearingCount<1)){var a=!1,s=[];void 0===e?a=!0:s=C(this,!0,e,n,i);for(var u=R(o,t),c=u.length,l=0;l<c;l++){var f=u[l],h=f.stationMeta;a&&(s=C(this,!0,e=f.listenerEventNames,n,i));for(var v=0,p=s;v<p.length;v++){var g=p[v];g.hearer=this,r(h,g)}}a?o.heardStations=Object.create(null):j(this)}},n.prototype.isHeard=function(t,e,r){var n=this.stationMeta,i=n.listenerCount;if(i<1)return!1;if(arguments.length<1)return i>0;for(var o=0,a=C(this,!0,t,e,r);o<a.length;o++)if(c(n,a[o]))return!0;return!1},n.prototype.isHearing=function(t,e,r,n){var i=this.stationMeta;if(i.hearingCount<1)return!1;var o=R(i,t),a=!1,s=[];e?s=C(this,!0,e,r,n):a=!0;for(var u=o.length,l=0;l<u;l++){var f=o[l],h=f.stationMeta;a&&(s=C(this,!0,e=f.listenerEventNames,r,n));for(var v=0,p=s;v<p.length;v++){var g=p[v];if(g.hearer=this,c(h,g))return!0}}return!1},n.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.stationMeta;if(!(n.listenerCount<1))for(var i=0,o=P(t,n);i<o.length;i++)S(o[i],this,!1,e)},n.prototype.emitAsync=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!T.$Promise)throw new Error("No promises implementation available.");var n=this.stationMeta;if(n.listenerCount<1)return T.$Promise.resolve([]);for(var i=[],o=0,a=P(t,n);o<a.length;o++){var s=a[o];i=i.concat(S(s,this,!0,e))}return i.length>0?T.$Promise.all(i):T.$Promise.resolve([])},n.prototype.makeListeners=function(t,e,r){var n=C(this,!1,t,e,r);return new L(this,n)},n.prototype.getListeners=function(t,r,n){var i=s(this.stationMeta);if(!(i.length<1)){if(arguments.length<1)return new L(this,i);for(var o=C(this,!0,t,r,n),a=[],u=0,c=i;u<c.length;u++)for(var l=c[u],f=0,h=o;f<h.length;f++)if(e(h[f],l)){a.push(l);break}if(!(a.length<1))return new L(this,a)}},n.prototype.toObservable=function(t,e,r){var n=this;if(!T.$RxObservable)throw new Error("Rx has not been injected. See documentation for details.");return T.$RxObservable.fromEventPattern(function(r){n.on(t,r,e)},function(r){n.off(t,r,e)},r)},n.prototype.stopPropagation=function(){this.stationMeta.isPropagationStopped=!0},n.prototype.addListener=function(e){t(this.stationMeta,e)},n.prototype.removeListener=function(t,e){r(this.stationMeta,t,e)},n.prototype.hasListener=function(t,e){return c(this.stationMeta,t,e)},n.init=function(t,e){return t.stationMeta=O(e),n},n.inject=function(t,e){return l(t,e),n},n.config=function(t){return M(t),n},n.reset=function(){return y(),f(),n},n.extend=function(t){for(var e=n.prototype,r=0,i=Object.keys(e);r<i.length;r++){var o=i[r],a=Object.getOwnPropertyDescriptor(e,o),s={configurable:!0};void 0!==a.get?s.get=a.get:s.value=a.value,Object.defineProperty(t,o,s)}return t},n.make=function(){var t=n.extend({});return n.init(t),t},n}();return z.EventStation=z,z.default=z,z});